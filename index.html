<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zombie Shooter</title>
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
    "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
  }
}
</script>
<style>
body { margin: 0; overflow: hidden; background: #000; font-family: monospace; }
canvas { display:block; }
#blocker { position:absolute;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;text-align:center;color:white;font-size:24px;cursor:pointer; }
#instructions { width:50%; }
#crosshair { position:absolute; top:50%; left:50%; width:12px; height:12px; border:2px solid white; border-radius:50%; transform:translate(-50%,-50%); pointer-events:none; }
#ui { position:absolute; bottom:20px; left:20px; color:#ff0000; font-size:32px; text-shadow:2px 2px 4px #000; }
#game-over { position:absolute;width:100%;height:100%;background-color:rgba(100,0,0,0.7);display:none;justify-content:center;align-items:center;text-align:center;flex-direction:column;color:white; }
#game-over h1 { font-size:72px;color:#ff0000;margin:0; }
#game-over p { font-size:24px; }
#restart-button { padding:15px 30px; font-size:20px; background-color:#ff0000;color:white;border:2px solid white;border-radius:10px;cursor:pointer;margin-top:20px; }
</style>
</head>
<body>
<div id="blocker">
  <div id="instructions">
    <h1>ZOMBIE SHOOTER</h1>
    <p>W,A,S,D to move | Space to jump</p>
    <p>Mouse to look | Right-click to aim</p>
    <p>Click to shoot | R to reload</p>
    <p>Click to play</p>
  </div>
</div>
<div id="crosshair"></div>
<div id="ui">
  <div id="ammo">AMMO: 30 / 90</div>
  <div id="health">HP: 100</div>
</div>
<div id="game-over">
  <h1>YOU DIED</h1>
  <p id="final-score">You survived 0 seconds</p>
  <button id="restart-button">RESTART</button>
</div>

<script type="module">
import * as THREE from 'three';
import { PointerLockControls } from 'three/examples/jsm/controls/PointerLockControls.js';
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';

// --- SCENE ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x333333);
scene.fog = new THREE.Fog(0x333333, 10, 200);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight,0.1,1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// --- LIGHT ---
const ambientLight = new THREE.AmbientLight(0xffffff,0.5);
scene.add(ambientLight);
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(10,50,10);
dirLight.castShadow = true;
scene.add(dirLight);

// --- CONTROLS ---
const controls = new PointerLockControls(camera, document.body);
document.getElementById('blocker').addEventListener('click',()=>controls.lock());
controls.addEventListener('lock',()=>{ document.getElementById('blocker').style.display='none'; });
controls.addEventListener('unlock',()=>{ document.getElementById('blocker').style.display='flex'; });
scene.add(controls.getObject());

// --- PLAYER STATE ---
let moveF=false, moveB=false, moveL=false, moveR=false;
const velocity = new THREE.Vector3();
const direction = new THREE.Vector3();
let canJump = true;
let playerHealth = 100;
let survivalTime = 0;

// --- GUN ---
const gun = new THREE.Group();
const gunBodyMat = new THREE.MeshStandardMaterial({ color:0x222222, roughness:0.4 });
const bodyGeo = new THREE.BoxGeometry(0.2,0.3,1);
const body = new THREE.Mesh(bodyGeo, gunBodyMat);
gun.add(body);
gun.position.set(0.5,-0.4,-1);
gun.rotation.y=Math.PI;
camera.add(gun);

// --- AIMING STATE ---
let isAiming = false;
const normalFOV = 75;
const aimFOV = 50;
const normalGunPos = new THREE.Vector3(0.5,-0.4,-1);
const aimGunPos = new THREE.Vector3(0.0,-0.3,-0.6);

// --- AMMO ---
let clip=30, reserve=90, canShoot=true, isReloading=false;
const ammoUI=document.getElementById('ammo');
const healthUI=document.getElementById('health');

// --- ZOMBIES / BULLETS omitted for brevity (unchanged, same as your paste) ---

// --- INPUTS ---
document.addEventListener('keydown',e=>{
  switch(e.code){
    case 'KeyW': moveF=true; break;
    case 'KeyS': moveB=true; break;
    case 'KeyA': moveL=true; break;
    case 'KeyD': moveR=true; break;
    case 'Space': if(canJump){ velocity.y=10; canJump=false; } break;
    case 'KeyR': if(!isReloading && reserve>0) reload(); break;
  }
});
document.addEventListener('keyup',e=>{
  switch(e.code){
    case 'KeyW': moveF=false; break;
    case 'KeyS': moveB=false; break;
    case 'KeyA': moveL=false; break;
    case 'KeyD': moveR=false; break;
  }
});
document.addEventListener('mousedown',e=>{
  if(!controls.isLocked) return;
  if(e.button===0) shoot(); // left click
  if(e.button===2) { isAiming = true; } // right click down
});
document.addEventListener('mouseup',e=>{
  if(e.button===2) { isAiming = false; } // right click up
});

// --- ANIMATE ---
const clock=new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);
  const delta=clock.getDelta();
  survivalTime+=delta;

  // Smooth FOV change
  camera.fov += ( (isAiming?aimFOV:normalFOV) - camera.fov ) * 0.1;
  camera.updateProjectionMatrix();

  // Smooth gun movement
  gun.position.lerp(isAiming?aimGunPos:normalGunPos,0.1);

  // movement / zombies / bullets updates here (same as before)...

  renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
